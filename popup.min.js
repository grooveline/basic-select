function loadList(){chrome.storage.local.get({auths:[]},e=>{const t=document.getElementById("auth-list");t.innerHTML="",e.auths.forEach((e,n)=>{const o=document.createElement("div");o.className="entry";const l=document.createElement("div");l.textContent=e.label,l.style.fontWeight="bold",o.appendChild(l);const a=document.createElement("div");a.className="button-row";const d=document.createElement("button");d.textContent="🌐 "+chrome.i18n.getMessage("auth_button"),d.onclick=(()=>applyAuth(e.username,e.password,e.url)),a.appendChild(d);const c=document.createElement("button");c.textContent="✏️ "+chrome.i18n.getMessage("edit_button"),c.onclick=(()=>openEditForm(n,e)),a.appendChild(c);const m=document.createElement("button");m.textContent="🗑 "+chrome.i18n.getMessage("delete_button"),m.onclick=(()=>deleteEntry(n)),a.appendChild(m),o.appendChild(a),t.appendChild(o)})})}function applyAuth(e,t,n=null){if(n){const o=new URL(n),l=`${o.protocol}//${e}:${t}@${o.host}${o.pathname}${o.search}${o.hash}`;chrome.tabs.create({url:l})}else chrome.tabs.query({active:!0,currentWindow:!0},n=>{const o=new URL(n[0].url),l=`${o.protocol}//${e}:${t}@${o.host}${o.pathname}${o.search}${o.hash}`;chrome.tabs.create({url:l})})}function openEditForm(e,t){document.getElementById("label").value=t.label,document.getElementById("url").value=t.url||"",document.getElementById("username").value=t.username,document.getElementById("password").value=t.password,document.getElementById("edit-index").value=e,document.getElementById("add-form").style.display="block"}function deleteEntry(e){confirm("本当に削除しますか？")&&chrome.storage.local.get({auths:[]},t=>{t.auths.splice(e,1),chrome.storage.local.set({auths:t.auths},loadList)})}function clearForm(){document.getElementById("label").value="",document.getElementById("url").value="",document.getElementById("username").value="",document.getElementById("password").value="",document.getElementById("edit-index").value="",document.getElementById("add-form").style.display="none"}document.getElementById("save-btn").textContent=chrome.i18n.getMessage("save_button"),document.getElementById("cancel-btn").textContent=chrome.i18n.getMessage("cancel_button"),document.getElementById("add-btn").textContent=chrome.i18n.getMessage("add_button"),document.title=chrome.i18n.getMessage("extension_name"),document.getElementById("html-title").textContent=chrome.i18n.getMessage("extension_name"),document.getElementById("main-heading").textContent=chrome.i18n.getMessage("main_heading"),document.getElementById("add-btn").onclick=(()=>{clearForm(),document.getElementById("add-form").style.display="block"}),document.getElementById("cancel-btn").onclick=(()=>{clearForm()}),document.getElementById("save-btn").onclick=(()=>{const e=document.getElementById("label").value,t=document.getElementById("url").value,n=document.getElementById("username").value,o=document.getElementById("password").value,l=document.getElementById("edit-index").value;chrome.storage.local.get({auths:[]},a=>{""!==l?a.auths[parseInt(l)]={label:e,url:t,username:n,password:o}:a.auths.push({label:e,url:t,username:n,password:o}),chrome.storage.local.set({auths:a.auths},()=>{loadList(),clearForm()})})}),loadList();